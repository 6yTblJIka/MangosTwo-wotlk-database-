-- --------------------------------------------------------------------------------
-- This is an attempt to create a full transactional MaNGOS update (v1.4)
-- --------------------------------------------------------------------------------
DROP PROCEDURE IF EXISTS `update_mangos`; 

DELIMITER $$

CREATE DEFINER=`root`@`localhost` PROCEDURE `update_mangos`()
BEGIN
    DECLARE bRollback BOOL  DEFAULT FALSE ;
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION SET `bRollback` = TRUE;

    -- Current Values (TODO - must be a better way to do this)
    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cCurStructure := (SELECT structure FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cCurContent := (SELECT content FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);

    -- Expected Values
    SET @cOldVersion = '21'; 
    SET @cOldStructure = '10'; 
    SET @cOldContent = '054';

    -- New Values
    SET @cNewVersion = '21';
    SET @cNewStructure = '10';
    SET @cNewContent = '055';
                            -- DESCRIPTION IS 30 Characters MAX    
    SET @cNewDescription = 'Add missing spawns';

                        -- COMMENT is 150 Characters MAX
    SET @cNewComment = 'Add missing spawns';

    -- Evaluate all settings
    SET @cCurResult := (SELECT description FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cOldResult := (SELECT description FROM db_version WHERE `version`=@cOldVersion AND `structure`=@cOldStructure AND `content`=@cOldContent);
    SET @cNewResult := (SELECT description FROM db_version WHERE `version`=@cNewVersion AND `structure`=@cNewStructure AND `content`=@cNewContent);

    IF (@cCurResult = @cOldResult) THEN    -- Does the current version match the expected version
        -- APPLY UPDATE
        START TRANSACTION;
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
        -- -- PLACE UPDATE SQL BELOW -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -

    -- Reworked and added missing spawns for Frosthorn Ram, Iceshard Elemental and Howling Cyclone.
-- Reused guid for current spawns in the DB.

SET @guid := (SELECT MAX(guid) FROM `creature`);
delete FROM creature WHERE id IN (24228,24229,23740);
insert into `creature` (`guid`,`id`, `map`, `spawnMask`, `modelid`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `MovementType`) values
(113678,23740,571,1,22673,2793.65,-5087.05,469.446,4.03554,300,8,0,8982,0,1),
(113679,23740,571,1,22673,2560.65,-4968.75,302.414,0.04333,300,8,0,8982,0,1),
(113680,23740,571,1,22673,3293.51,-4641.52,269.085,0.657714,300,8,0,8982,0,1),
(113681,23740,571,1,22673,3286.73,-4702.52,294.303,5.55497,300,8,0,8982,0,1),
(113684,23740,571,1,22673,2803.39,-5272.91,493.464,5.5254,300,8,0,8982,0,1),
(113686,23740,571,1,22673,2771.62,-5258.77,471.597,4.14633,300,8,0,8982,0,1),
(113687,23740,571,1,22673,2793.61,-5207.76,461.242,4.37682,300,8,0,8982,0,1),
(113688,23740,571,1,22673,3283.93,-4702.48,294.702,4.09573,300,8,0,8982,0,1),
(113690,23740,571,1,22673,2730.96,-5056.61,404.898,3.50262,300,8,0,8982,0,1),
(113691,23740,571,1,22673,2625.71,-4967.58,335.216,5.09514,300,8,0,8982,0,1),
(113692,23740,571,1,22673,3347.97,-4685.32,261.823,4.6168,300,8,0,8982,0,1),
(113693,23740,571,1,22673,2584.42,-4887.13,327.142,3.69837,300,8,0,8982,0,1),
(113694,23740,571,1,22673,2587.11,-4892.46,327.125,5.88381,300,8,0,8982,0,1),
(113695,23740,571,1,22673,2620.11,-4836.48,290.309,6.00034,300,8,0,8982,0,1),
(113696,23740,571,1,22673,2763.75,-4864.69,354.271,3.91972,300,8,0,8982,0,1),
(113697,23740,571,1,22673,2752.4,-4668.96,291.584,5.10198,300,8,0,8982,0,1),
(113698,23740,571,1,22673,2510.22,-5635.78,300.096,5.34729,300,8,0,8982,0,1),
(113699,23740,571,1,22673,2590.22,-4259.96,278.255,1.0039,300,8,0,8982,0,1),
(113700,23740,571,1,22673,2536.56,-5107.69,332.925,4.2228,300,8,0,8982,0,1),
(113701,23740,571,1,22673,2781.88,-5113.61,464.432,0.759869,300,8,0,8982,0,1),
(113702,23740,571,1,22673,2575.58,-5813.21,294.735,3.20218,300,8,0,8982,0,1),
(113703,23740,571,1,22673,3215.93,-4642.16,327.797,3.2923,300,8,0,8982,0,1),
(113704,23740,571,1,22673,3274.84,-4439.54,331.265,3.96061,300,8,0,8982,0,1),
(113705,23740,571,1,22673,2466.84,-5772.73,284.664,5.4012,300,8,0,8982,0,1),
(113706,23740,571,1,22673,2509.79,-5778.34,287.932,5.79334,300,8,0,8982,0,1),
(113707,23740,571,1,22673,2581.97,-5650.89,310.547,0.733613,300,8,0,8982,0,1),
(113708,23740,571,1,22673,2569.47,-5779.44,298.79,3.28459,300,8,0,8982,0,1),
(113709,23740,571,1,22673,2550.39,-5679.97,306.562,0.836529,300,8,0,8982,0,1),
(113710,23740,571,1,22673,3279.64,-4430.55,327.405,1.41079,300,8,0,8982,0,1),
(113711,23740,571,1,22673,2743.16,-5114.61,431.436,6.16832,300,8,0,8982,0,1),
(113712,23740,571,1,22673,2751.3,-5138.2,426.857,3.76536,300,8,0,8982,0,1),
(113713,23740,571,1,22673,2545.39,-5768.67,296.324,4.78856,300,8,0,8982,0,1),
(113714,23740,571,1,22673,2448.14,-4040.65,239.659,1.23329,300,8,0,8982,0,1),
(113715,23740,571,1,22673,2436.53,-4108.93,235.383,3.5094,300,8,0,8982,0,1),
(113716,23740,571,1,22673,2450.22,-4074.78,237.571,4.64471,300,8,0,8982,0,1),
(113717,23740,571,1,22673,2496.64,-4017.96,251.452,3.31027,300,8,0,8982,0,1),
(113718,23740,571,1,22673,2485.62,-4010.34,249.277,4.16477,300,8,0,8982,0,1),
(113719,23740,571,1,22673,2476.45,-4048.63,245.634,4.64139,300,8,0,8982,0,1),
(113720,23740,571,1,22673,2497.45,-3929.7,255.171,5.86496,300,8,0,8982,0,1),
(113721,23740,571,1,22673,2426.16,-4139.46,237.445,4.98791,300,8,0,8982,0,1),
(113722,23740,571,1,22673,2394.56,-4186.23,234.251,3.47168,300,8,0,8982,0,1),
(113723,23740,571,1,22673,2453.57,-4178.09,248.288,4.12077,300,8,0,8982,0,1),
(113724,23740,571,1,22673,2439.01,-4251.89,242.505,1.60986,300,8,0,8982,0,1),
(113725,23740,571,1,22673,2452.27,-4251.13,244.005,5.77308,300,8,0,8982,0,1),
(113726,23740,571,1,22673,2827.87,-5194.62,505.716,4.58389,300,8,0,8982,0,1),
(113728,23740,571,1,22673,2737.83,-5333.86,401.556,1.75637,300,8,0,8982,0,1),
(113729,23740,571,1,22673,2690.76,-5375.96,384.404,3.9125,300,8,0,8982,0,1),
(113730,23740,571,1,22673,2714.63,-5331.32,394.595,1.70239,300,8,0,8982,0,1),
(113731,23740,571,1,22673,2697.51,-5240.92,386.462,0.178631,300,8,0,8982,0,1),
(113732,23740,571,1,22673,2479.42,-5287.34,288.217,4.86316,300,8,0,8982,0,1),
(113733,23740,571,1,22673,2389.46,-4925.91,255.493,4.54879,300,8,0,8982,0,1),
(113734,23740,571,1,22673,2412.77,-4848.57,252.057,1.4709,300,8,0,8982,0,1),
(113735,23740,571,1,22673,2459.35,-4844.29,256.636,0.811299,300,8,0,8982,0,1),
(113736,23740,571,1,22673,3372.18,-4545.62,231.175,6.1861,300,8,0,8982,0,1),
(113737,23740,571,1,22673,2496.19,-4234.96,261.609,3.59858,300,8,0,8982,0,1),
(113738,23740,571,1,22673,2629.17,-4695.83,255.149,4.55881,300,8,0,8982,0,1),
(113739,23740,571,1,22673,2509.24,-4803.14,252.389,3.15373,300,8,0,8982,0,1),
(113740,23740,571,1,22673,2571.59,-4756.05,259.56,4.1347,300,8,0,8982,0,1),
(113741,23740,571,1,22673,2595.44,-4736.34,257.685,2.48678,300,8,0,8982,0,1),
(113742,23740,571,1,22673,2561.97,-4826.52,259.925,0.105695,300,8,0,8982,0,1),
(113743,23740,571,1,22673,2556.25,-4760.42,259.695,5.73605,300,8,0,8982,0,1),
(113744,23740,571,1,22673,2616.55,-5087.94,330.662,1.10779,300,8,0,8982,0,1),
(113745,23740,571,1,22673,2621.39,-5093.76,333.911,3.23941,300,8,0,8982,0,1),
(113746,23740,571,1,22673,2684.62,-5253.46,381.018,6.20031,300,8,0,8982,0,1),
(113747,23740,571,1,22673,2705.89,-5354.11,390.739,3.24729,300,8,0,8982,0,1),
(113748,23740,571,1,22673,2676.4,-5129.18,380.057,0.001953,300,8,0,8982,0,1),
(113749,23740,571,1,22673,2700.67,-5291.37,386.153,5.23715,300,8,0,8982,0,1),
(113750,23740,571,1,22673,2783.69,-5097.61,467.946,0.371776,300,8,0,8982,0,1),
(113751,23740,571,1,22673,2699.27,-5313.76,387.059,1.55029,300,8,0,8982,0,1),
(113752,23740,571,1,22673,2429.43,-5367.25,269.728,4.14903,300,8,0,8982,0,1),
(113753,23740,571,1,22673,2453.04,-5547.11,303.824,1.56201,300,8,0,8982,0,1),
(113754,23740,571,1,22673,2415.11,-5436.91,268.943,3.00246,300,8,0,8982,0,1),
(113755,23740,571,1,22673,2447.26,-5389.72,279.179,1.71476,300,8,0,8982,0,1),
(113756,23740,571,1,22673,2434.03,-5317.22,263.234,5.30662,300,8,0,8982,0,1),
(113757,23740,571,1,22673,2393.67,-5560.63,285.949,3.62905,300,8,0,8982,0,1),
(113758,23740,571,1,22673,2475.52,-5622.05,298.55,2.94011,300,8,0,8982,0,1),
(113759,23740,571,1,22673,2414.17,-5604.03,295.077,1.75458,300,8,0,8982,0,1),
(113760,23740,571,1,22673,2423.08,-5588.65,296.995,6.12029,300,8,0,8982,0,1),
(113761,23740,571,1,22673,2484.87,-5654.95,291.804,0.975652,300,8,0,8982,0,1),
(113762,23740,571,1,22673,2749.53,-4691.88,286.408,4.71319,300,8,0,8982,0,1),
(113763,23740,571,1,22673,2679.69,-4739.78,261.815,0.133197,300,8,0,8982,0,1),
(113764,23740,571,1,22673,2685.05,-4722.1,259.665,0.505761,300,8,0,8982,0,1),
(113765,23740,571,1,22673,2746.05,-4675.58,292.176,3.36217,300,8,0,8982,0,1),
(113766,23740,571,1,22673,2436.34,-4252.9,242.255,2.58784,300,8,0,8982,0,1),
(113770,23740,571,1,22673,2729.84,-4774.68,291.903,4.53,300,8,0,8982,0,1),
(@guid+1,23740,571,1,22673,2485.69,-4355.83,253.445,5.12379,300,8,0,8982,0,1),
(@guid+2,23740,571,1,22673,2654.85,-4450.86,249.605,4.94303,300,8,0,8982,0,1),
(@guid+3,23740,571,1,22673,3255.5,-4497.58,339.354,0.928291,300,8,0,8982,0,1),
(@guid+4,23740,571,1,0,2840.79,-5250.66,522.128,0.420405,120,8,0,8982,0,1),
(@guid+5,23740,571,1,0,2847.91,-5350.59,509.874,5.04076,120,8,0,8982,0,1),
(@guid+6,23740,571,1,0,2855.06,-5349.24,510.798,1.21134,120,8,0,8982,0,1),
(@guid+7,23740,571,1,0,2865.1,-5129.04,527.953,1.54932,120,8,0,8982,0,1),
(@guid+8,23740,571,1,0,2865.57,-5278.08,525.744,3.21581,120,8,0,8982,0,1),
(@guid+9,23740,571,1,0,2868.51,-5345.63,512.951,3.32022,120,8,0,8982,0,1),
(@guid+10,23740,571,1,0,2874.97,-5040.57,521.258,2.08946,120,8,0,8982,0,1),
(@guid+11,23740,571,1,0,2884.66,-5379.85,508.969,1.14955,120,8,0,8982,0,1),
(@guid+12,23740,571,1,0,2903.4,-5390.3,524.351,3.23941,120,8,0,8982,0,1),
(@guid+13,23740,571,1,0,2921.9,-5225.16,595.508,5.24159,120,8,0,8982,0,1),
(@guid+14,23740,571,1,0,2927.14,-5227.77,603.304,1.9916,120,8,0,8982,0,1),
(@guid+15,23740,571,1,0,2944.65,-5405.99,560.168,2.21,120,8,0,8982,0,1),
(@guid+16,23740,571,1,0,2945.59,-5221.48,631.129,2.83405,120,8,0,8982,0,1),
(@guid+17,23740,571,1,0,2947.62,-5249.43,610.198,1.48571,120,8,0,8982,0,1),
(@guid+18,23740,571,1,0,2953.68,-5245.48,620.414,4.90806,120,8,0,8982,0,1),
(@guid+19,23740,571,1,0,2954.81,-5143.5,663.672,1.51606,120,8,0,8982,0,1),
(@guid+20,23740,571,1,0,2973.05,-5110.13,702.137,1.07834,120,8,0,8982,0,1),
(@guid+21,23740,571,1,0,3021.26,-5280.67,652.396,4.38987,120,8,0,8982,0,1),
(@guid+22,23740,571,1,0,3023.33,-5231.88,677.494,2.77414,120,8,0,8982,0,1),
(@guid+23,23740,571,1,0,3024.47,-5393.01,573.916,2.34238,120,8,0,8982,0,1),
(@guid+24,23740,571,1,0,3035.42,-5135.66,716.228,1.5708,120,8,0,8982,0,1),
(@guid+25,23740,571,1,0,3039.78,-5238.48,689.857,6.23158,120,8,0,8982,0,1),
(@guid+26,23740,571,1,0,3058.36,-5266.33,677.327,2.29533,120,8,0,8982,0,1),
(@guid+27,23740,571,1,0,3058.65,-5341.5,621.111,2.09733,120,8,0,8982,0,1),
(@guid+28,23740,571,1,0,3107.3,-5172.49,720.29,2.59531,120,8,0,8982,0,1),
(@guid+29,23740,571,1,0,3066.99,-5369,587.096,2.48697,120,8,0,8982,0,1),
(@guid+30,23740,571,1,0,2693.17,-4597.98,254.053,2.64483,120,8,0,8982,0,1),
(@guid+31,23740,571,1,0,2694.2,-4602.05,253.895,5.48312,120,8,0,8982,0,1),
(@guid+32,23740,571,1,0,2699.93,-4599.08,255.553,2.67101,120,8,0,8982,0,1),
(@guid+33,23740,571,1,0,2752.58,-4601.06,267.302,0.492024,120,8,0,8982,0,1),
(@guid+34,23740,571,1,0,2815.33,-4533.04,274.983,2.35619,120,8,0,8982,0,1),
(@guid+35,23740,571,1,0,2820.53,-4632.88,281.838,4.64405,120,8,0,8982,0,1),
(@guid+36,23740,571,1,0,2845.68,-4642.02,284.015,5.86953,120,8,0,8982,0,1),
(@guid+37,23740,571,1,0,2927.51,-4511.32,282.019,3.48836,120,8,0,8982,0,1),
(@guid+38,23740,571,1,0,2936.06,-4510.92,284.395,4.95689,120,8,0,8982,0,1),
(@guid+39,23740,571,1,0,2964.55,-4610.52,288.112,3.48967,120,8,0,8982,0,1),
(@guid+40,23740,571,1,0,2977.26,-4551.56,288.367,3.14159,120,8,0,8982,0,1),
(@guid+41,23740,571,1,0,3009.48,-4473.3,309.755,2.46257,120,8,0,8982,0,1),
(@guid+42,23740,571,1,0,3045.14,-4644.44,310.68,2.17288,120,8,0,8982,0,1),
(@guid+43,23740,571,1,0,3062.64,-4446.73,332.202,5.72605,120,8,0,8982,0,1),
(@guid+44,23740,571,1,0,3075.74,-4673.82,311.431,3.34965,120,8,0,8982,0,1),
(@guid+45,23740,571,1,0,3107.85,-4569.16,322.007,4.74596,120,8,0,8982,0,1),
(@guid+46,23740,571,1,0,3114.97,-4458.32,330.346,0.627304,120,8,0,8982,0,1),
(@guid+47,23740,571,1,0,3117.07,-4614.31,322.667,2.78716,120,8,0,8982,0,1),
(@guid+48,23740,571,1,0,3120.64,-4419.91,332.682,5.55713,120,8,0,8982,0,1),
(@guid+49,23740,571,1,0,3147.29,-4573.56,331.16,4.51903,120,8,0,8982,0,1),
(@guid+50,23740,571,1,0,3150.48,-4455.64,330.876,4.03765,120,8,0,8982,0,1),
(@guid+51,23740,571,1,0,3152.85,-4385.75,334.411,5.24568,120,8,0,8982,0,1),
(@guid+52,23740,571,1,0,3162.55,-4463.74,331.798,4.3917,120,8,0,8982,0,1),
(@guid+53,23740,571,1,0,3168.2,-4448.92,330.389,0.393013,120,8,0,8982,0,1),
(@guid+54,23740,571,1,0,3179.86,-4433.46,330.264,2.97994,120,8,0,8982,0,1),
(@guid+55,23740,571,1,0,3217.8,-4647.21,328.422,0.0229795,120,8,0,8982,0,1),
(@guid+56,23740,571,1,0,3226.66,-4650.54,328.322,3.76536,120,8,0,8982,0,1),
(@guid+57,23740,571,1,0,3229.76,-4596.07,316.482,5.31,120,8,0,8982,0,1),
(@guid+58,23740,571,1,0,3230.32,-4538.94,337.46,0.867931,120,8,0,8982,0,1),
(@guid+59,23740,571,1,0,2620.95,-5678.31,321.547,3.57291,120,8,0,8982,0,1),
(111314,24228,571,1,0,2894.91,-4889.15,405.86,6.17501,120,8,0,9291,0,1),
(111315,24228,571,1,0,2862.83,-4587.84,273.69,4.67752,120,8,0,9291,0,1),
(111317,24228,571,1,0,2777.66,-4840.82,336.641,5.60509,120,8,0,9291,0,1),
(111318,24228,571,1,0,2731.97,-4951.51,344.676,0.705851,120,8,0,9291,0,1),
(111319,24228,571,1,0,2706.69,-4892.57,307.756,4.38246,120,8,0,9291,0,1),
(111321,24228,571,1,0,2656.94,-4997.91,337.96,2.40798,120,8,0,9291,0,1),
(111322,24228,571,1,0,2604.58,-4911.85,297.078,2.51539,120,8,0,9291,0,1),
(111323,24228,571,1,0,2581.49,-4924.21,290.974,1.26938,120,8,0,9291,0,1),
(@guid+60,24228,571,1,0,2910.86,-4732.55,322.09,4.99431,120,8,0,9291,0,1),
(@guid+61,24228,571,1,0,2923.28,-4785.25,328.771,1.20334,120,8,0,9291,0,1),
(@guid+62,24228,571,1,0,2926.84,-4557.84,273.69,2.24792,120,8,0,9291,0,1),
(@guid+63,24228,571,1,0,2947.94,-4956.58,462.833,4.11254,120,8,0,9291,0,1),
(@guid+64,24228,571,1,0,2963.54,-4887.32,425.588,4.22889,120,8,0,9291,0,1),
(@guid+65,24228,571,1,0,2974.49,-4755.24,328.122,3.37338,120,8,0,9291,0,1),
(@guid+66,24228,571,1,0,2995.91,-4803.81,347.048,5.17883,120,8,0,9291,0,1),
(@guid+67,24228,571,1,0,2996.18,-4960.99,479.916,5.22214,120,8,0,9291,0,1),
(@guid+68,24228,571,1,0,3020.31,-4557.62,306.339,2.72176,120,8,0,9291,0,1),
(@guid+69,24228,571,1,0,3031.17,-4913,451.326,4.42343,120,8,0,9291,0,1),
(@guid+70,24228,571,1,0,3038.88,-4504.17,315.735,3.74893,120,8,0,9291,0,1),
(@guid+71,24228,571,1,0,3071.56,-4844.54,387.802,4.15352,120,8,0,9291,0,1),
(@guid+72,24228,571,1,0,3076.04,-4537.47,306.664,1.27557,120,8,0,9291,0,1),
(@guid+73,24228,571,1,0,3096.7,-4797.55,347.546,1.10802,120,8,0,9291,0,1),
(@guid+74,24228,571,1,0,3128.62,-4505.71,330.253,2.78749,120,8,0,9291,0,1),
(@guid+75,24228,571,1,0,3143.26,-4448.64,330.549,1.35719,120,8,0,9291,0,1),
(@guid+76,24228,571,1,0,3181.18,-4555.87,329.936,5.17342,120,8,0,9291,0,1),
(@guid+77,24228,571,1,0,3197.29,-4450.44,330.639,1.15585,120,8,0,9291,0,1),
(138968,24229,571,1,0,2808.84,-5042.93,462.968,1.98057,120,0,0,8982,0,2),
(138969,24229,571,1,0,2882.19,-5461.41,541.189,2.19725,120,8,0,8982,0,1),
(@guid+78,24229,571,1,0,2911.03,-5503.74,547.631,4.54662,120,8,0,8982,0,1),
(@guid+79,24229,571,1,0,2974.09,-5468.46,541.771,0.987839,120,8,0,8982,0,1),
(@guid+80,24229,571,1,0,2995.07,-5183.02,672.962,1.43553,120,8,0,8982,0,1),
(@guid+81,24229,571,1,0,3045.66,-5437.89,535.157,1.82335,120,8,0,8982,0,1),
(@guid+82,24229,571,1,0,3049.64,-5250.37,684.982,0.81297,120,8,0,8982,0,1),
(@guid+83,24229,571,1,0,3083.39,-5146,732.628,0.809768,120,8,0,8982,0,1),
(@guid+84,24229,571,1,0,3125.19,-5272.47,603.245,3.58123,120,8,0,8982,0,1),
(@guid+85,24229,571,1,0,3139.95,-5121.66,647.618,2.92716,120,8,0,8982,0,1),
(@guid+86,24229,571,1,0,3152.91,-5423.34,462.348,2.73757,120,8,0,8982,0,1),
(@guid+87,24229,571,1,0,3164.65,-5088.24,584.768,1.57531,120,8,0,8982,0,1);


        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
        -- -- PLACE UPDATE SQL ABOVE -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -

        -- If we get here ok, commit the changes
        IF bRollback = TRUE THEN
            ROLLBACK;
            SHOW ERRORS;
            SELECT '* UPDATE FAILED *' AS `===== Status =====`,@cCurResult AS `===== DB is on Version: =====`;
        ELSE
            COMMIT;
            -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
            -- UPDATE THE DB VERSION
            -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
            INSERT INTO `db_version` VALUES (@cNewVersion, @cNewStructure, @cNewContent, @cNewDescription, @cNewComment);
            SET @cNewResult := (SELECT description FROM db_version WHERE `version`=@cNewVersion AND `structure`=@cNewStructure AND `content`=@cNewContent);

            SELECT '* UPDATE COMPLETE *' AS `===== Status =====`,@cNewResult AS `===== DB is now on Version =====`;
        END IF;
    ELSE    -- Current version is not the expected version
        IF (@cCurResult = @cNewResult) THEN    -- Does the current version match the new version
            SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cCurResult AS `===== DB is already on Version =====`;
        ELSE    -- Current version is not one related to this update
            IF(@cCurResult IS NULL) THEN    -- Something has gone wrong
                SELECT '* UPDATE FAILED *' AS `===== Status =====`,'Unable to locate DB Version Information' AS `============= Error Message =============`;
            ELSE
                IF(@cOldResult IS NULL) THEN    -- Something has gone wrong
                    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurStructure := (SELECT `STRUCTURE` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurContent := (SELECT `Content` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurOutput = CONCAT(@cCurVersion, '_', @cCurStructure, '_', @cCurContent, ' - ',@cCurResult);
                    SET @cOldResult = CONCAT('Rel',@cOldVersion, '_', @cOldStructure, '_', @cOldContent, ' - ','IS NOT APPLIED');
                    SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cOldResult AS `=== Expected ===`,@cCurOutput AS `===== Found Version =====`;
                ELSE
                    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurStructure := (SELECT `STRUCTURE` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurContent := (SELECT `Content` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurOutput = CONCAT(@cCurVersion, '_', @cCurStructure, '_', @cCurContent, ' - ',@cCurResult);
                    SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cOldResult AS `=== Expected ===`,@cCurOutput AS `===== Found Version =====`;
                END IF;
            END IF;
        END IF;
    END IF;
END $$

DELIMITER ;

-- Execute the procedure
CALL update_mangos();

-- Drop the procedure
DROP PROCEDURE IF EXISTS `update_mangos`;


