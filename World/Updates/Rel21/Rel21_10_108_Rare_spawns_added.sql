-- --------------------------------------------------------------------------------
-- This is an attempt to create a full transactional MaNGOS update (v1.4)
-- --------------------------------------------------------------------------------
DROP PROCEDURE IF EXISTS `update_mangos`; 

DELIMITER $$

CREATE DEFINER=`root`@`localhost` PROCEDURE `update_mangos`()
BEGIN
    DECLARE bRollback BOOL  DEFAULT FALSE ;
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION SET `bRollback` = TRUE;

    -- Current Values (TODO - must be a better way to do this)
    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cCurStructure := (SELECT structure FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cCurContent := (SELECT content FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);

    -- Expected Values
    SET @cOldVersion = '21'; 
    SET @cOldStructure = '10'; 
    SET @cOldContent = '107';

    -- New Values
    SET @cNewVersion = '21';
    SET @cNewStructure = '10';
    SET @cNewContent = '108';
                            -- DESCRIPTION IS 30 Characters MAX    
    SET @cNewDescription = 'Rare spawns added';

                        -- COMMENT is 150 Characters MAX
    SET @cNewComment = 'Rare spawns added';

    -- Evaluate all settings
    SET @cCurResult := (SELECT description FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
    SET @cOldResult := (SELECT description FROM db_version WHERE `version`=@cOldVersion AND `structure`=@cOldStructure AND `content`=@cOldContent);
    SET @cNewResult := (SELECT description FROM db_version WHERE `version`=@cNewVersion AND `structure`=@cNewStructure AND `content`=@cNewContent);

    IF (@cCurResult = @cOldResult) THEN    -- Does the current version match the expected version
        -- APPLY UPDATE
        START TRANSACTION;
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
        -- -- PLACE UPDATE SQL BELOW -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -

    
SET @guid := (SELECT MAX(guid) FROM `creature`); 
SET @pool_entry := (SELECT MAX(entry) FROM `pool_template`);
DELETE FROM `creature` WHERE `id` = 18695;
INSERT INTO `creature` (`guid`, `id`, `map`, `spawnMask`, `modelid`, `equipment_id`, `position_x`, `position_y`, `position_z`, `orientation`, `spawntimesecs`, `spawndist`, `currentwaypoint`, `curhealth`, `curmana`, `DeathState`, `MovementType`) VALUES
-- Ambassador Jerrikar 
(@guid+1,18695,530,1,0,0,-4075.71,2580.33,135.002,1.76514,86400,0,0,13522,0,0,2),
(@guid+2,18695,530,1,0,0,-4465.49,1741.74,159.227,5.19891,100800,0,0,13522,0,0,2),
(@guid+3,18695,530,1,0,0,-4169.96,516.327,26.1044,3.79743,108000,0,0,13522,0,0,2),
(@guid+4,18695,530,1,0,0,-3361.35,1196.06,62.5299,4.75752,115200,0,0,13522,0,0,2),
(@guid+5,18695,530,1,0,0,-3028.02,1581.67,64.2494,2.03534,122400,0,0,13522,0,0,2);

-- Bog Lurker location / move type update.
UPDATE `creature` SET `position_x` = -294.88, `position_x` = 6443.21, `position_y` = 19.3571, `orientation` = 5.86619, `MovementType` = 2 WHERE `guid` = 86744;
UPDATE `creature` SET `position_x` = -1023.69, `position_x` = 5095.25, `position_y` = 17.3841, `orientation` = 6.16307, `MovementType` = 2 WHERE `guid` = 86745;
UPDATE `creature` SET `position_x` = -294.88, `position_x` = 8023.15, `position_y` = 17.7483, `orientation` = 0.670779, `MovementType` = 2 WHERE `guid` = 86746;

-- Ambassador Jerrikar, Bog Lurker waypoints.
INSERT INTO `creature_movement` (`id`, `point`, `position_x`, `position_y`, `position_z`, `waittime`, `script_id`, `textid1`, `textid2`, `textid3`, `textid4`, `textid5`, `emote`, `spell`, `orientation`, `model1`, `model2`) VALUES
(@guid+1,1,-4075.71,2580.33,135.002,0,0,0,0,0,0,0,0,0,0.035804,0,0),
(@guid+1,2,-4057.45,2580.98,129.419,0,0,0,0,0,0,0,0,0,0.513326,0,0),
(@guid+1,3,-4016.42,2603.85,114.945,0,0,0,0,0,0,0,0,0,0.277706,0,0),
(@guid+1,4,-3971.13,2618.28,105.677,0,0,0,0,0,0,0,0,0,0.28556,0,0),
(@guid+1,5,-3931.96,2620.31,103.518,0,0,0,0,0,0,0,0,0,6.02682,0,0),
(@guid+1,6,-3891.68,2609.75,94.2714,0,0,0,0,0,0,0,0,0,5.67496,0,0),
(@guid+1,7,-3861.79,2588.95,92.7909,0,0,0,0,0,0,0,0,0,0.141831,0,0),
(@guid+1,8,-3811.96,2593.8,90.239,0,0,0,0,0,0,0,0,0,0.122196,0,0),
(@guid+1,9,-3798.66,2606.71,90.3513,0,0,0,0,0,0,0,0,0,1.34742,0,0),
(@guid+1,10,-3795.06,2630.71,92.2314,0,0,0,0,0,0,0,0,0,1.52256,0,0),
(@guid+1,11,-3795.33,2657.06,101.73,0,0,0,0,0,0,0,0,0,0.656267,0,0),
(@guid+1,12,-3779.87,2668.97,101.232,0,0,0,0,0,0,0,0,0,0.156753,0,0),
(@guid+1,13,-3693.65,2668.37,107.487,0,0,0,0,0,0,0,0,0,4.3966,0,0),
(@guid+2,1,-4465.49,1741.74,159.227,0,0,0,0,0,0,0,0,0,4.55262,0,0),
(@guid+2,2,-4468.25,1715.11,159.499,0,0,0,0,0,0,0,0,0,4.32878,0,0),
(@guid+2,3,-4473.41,1702.46,160.759,0,0,0,0,0,0,0,0,0,4.63901,0,0),
(@guid+2,4,-4473.76,1681.35,162.28,0,0,0,0,0,0,0,0,0,3.779,0,0),
(@guid+2,5,-4497.81,1677.15,165.846,0,0,0,0,0,0,0,0,0,3.11141,0,0),
(@guid+2,6,-4526.19,1678.13,175.257,0,0,0,0,0,0,0,0,0,3.02894,0,0),
(@guid+2,7,-4548.16,1678.87,174.776,0,0,0,0,0,0,0,0,0,2.21213,0,0),
(@guid+2,8,-4560.57,1696.35,174.429,0,0,0,0,0,0,0,0,0,0.802338,0,0),
(@guid+2,9,-4534.67,1715.35,174.333,0,0,0,0,0,0,0,0,0,2.27889,0,0),
(@guid+2,10,-4540.7,1722.39,174.364,0,0,0,0,0,0,0,0,0,3.90466,0,0),
(@guid+2,11,-4570.23,1673.95,174.765,0,0,0,0,0,0,0,0,0,4.65864,0,0),
(@guid+2,12,-4556.09,1634.04,174.413,0,0,0,0,0,0,0,0,0,3.73212,0,0),
(@guid+2,13,-4549.2,1662.49,174.447,0,0,0,0,0,0,0,0,0,0.656261,0,0),
(@guid+2,14,-4524.23,1673.72,175.252,0,0,0,0,0,0,0,0,0,6.20902,0,0),
(@guid+2,15,-4498.8,1671.21,165.909,0,0,0,0,0,0,0,0,0,5.60034,0,0),
(@guid+2,16,-4474.22,1655.08,162.994,0,0,0,0,0,0,0,0,0,4.88563,0,0),
(@guid+2,17,-4460.39,1606.96,163.121,0,0,0,0,0,0,0,0,0,5.12911,0,0),
(@guid+2,18,-4448.64,1583.59,164.034,0,0,0,0,0,0,0,0,0,6.11635,0,0),
(@guid+2,19,-4411.11,1580.13,163.702,0,0,0,0,0,0,0,0,0,0.547875,0,0),
(@guid+2,20,-4392.48,1591.57,163.285,0,0,0,0,0,0,0,0,0,1.09765,0,0),
(@guid+2,21,-4368.67,1635.85,156.371,0,0,0,0,0,0,0,0,0,1.47857,0,0),
(@guid+2,22,-4367.68,1675.5,157.308,0,0,0,0,0,0,0,0,0,2.21292,0,0),
(@guid+2,23,-4388.41,1705.66,156.436,0,0,0,0,0,0,0,0,0,2.64096,0,0),
(@guid+2,24,-4423.9,1722.95,157.067,0,0,0,0,0,0,0,0,0,2.64096,0,0),
(@guid+3,1,-4169.96,516.327,26.1044,0,0,0,0,0,0,0,0,0,2.64096,0,0),
(@guid+3,2,-4177.71,515.877,25.2113,0,0,0,0,0,0,0,0,0,4.26674,0,0),
(@guid+3,3,-4181.79,505.748,27.8272,0,0,0,0,0,0,0,0,0,4.72619,0,0),
(@guid+3,4,-4182.5,492.379,29.1442,0,0,0,0,0,0,0,0,0,3.71303,0,0),
(@guid+3,5,-4195.37,482.944,29.7653,0,0,0,0,0,0,0,0,0,3.21823,0,0),
(@guid+3,6,-4216.87,482.478,33.6687,0,0,0,0,0,0,0,0,0,3.83084,0,0),
(@guid+3,7,-4229.05,471.532,40.1721,0,0,0,0,0,0,0,0,0,4.58089,0,0),
(@guid+3,8,-4230.16,457.913,45.8716,0,0,0,0,0,0,0,0,0,5.38592,0,0),
(@guid+3,9,-4217.24,441.858,47.4628,0,0,0,0,0,0,0,0,0,4.78117,0,0),
(@guid+3,10,-4223.83,424.661,49.881,0,0,0,0,0,0,0,0,0,4.0429,0,0),
(@guid+3,11,-4253.25,378.726,77.7883,0,0,0,0,0,0,0,0,0,3.35567,0,0),
(@guid+3,12,-4268.08,376.821,79.3743,0,0,0,0,0,0,0,0,0,3.96043,0,0),
(@guid+3,13,-4287.69,350.027,101.469,0,0,0,0,0,0,0,0,0,3.98399,0,0),
(@guid+3,14,-4299.35,330.594,110.523,0,0,0,0,0,0,0,0,0,4.70263,0,0),
(@guid+3,15,-4297.03,309.694,118.697,0,0,0,0,0,0,0,0,0,5.16601,0,0),
(@guid+3,16,-4292.15,296.065,121.796,0,0,0,0,0,0,0,0,0,5.90428,0,0),
(@guid+3,17,-4238.48,271.237,122.493,0,0,0,0,0,0,0,0,0,0.017714,0,0),
(@guid+3,18,-4221.39,274.691,122.37,0,0,0,0,0,0,0,0,0,0.85809,0,0),
(@guid+3,19,-4215.31,280.698,122.542,0,0,0,0,0,0,0,0,0,1.19188,0,0),
(@guid+3,20,-4210.35,293.733,122.793,0,0,0,0,0,0,0,0,0,1.33326,0,0),
(@guid+3,21,-4207.68,312.923,123.018,0,0,0,0,0,0,0,0,0,0.677448,0,0),
(@guid+3,22,-4195.38,321.624,122.314,0,0,0,0,0,0,0,0,0,1.5571,0,0),
(@guid+3,23,-4196.27,331.13,119.068,0,0,0,0,0,0,0,0,0,3.27319,0,0),
(@guid+3,24,-4228.72,322.865,122.659,0,0,0,0,0,0,0,0,0,3.41063,0,0),
(@guid+4,1,-3361.35,1196.06,62.5307,0,0,0,0,0,0,0,0,0,4.57301,0,0),
(@guid+4,2,-3365.38,1173.51,59.1371,0,0,0,0,0,0,0,0,0,4.42771,0,0),
(@guid+4,3,-3373.31,1147.16,53.9433,0,0,0,0,0,0,0,0,0,4.56516,0,0),
(@guid+4,4,-3372.94,1129.12,49.5635,0,0,0,0,0,0,0,0,0,4.34917,0,0),
(@guid+4,5,-3377.21,1118.26,48.4891,0,0,0,0,0,0,0,0,0,4.86361,0,0),
(@guid+4,6,-3367.83,1077.38,45.7798,0,0,0,0,0,0,0,0,0,5.5626,0,0),
(@guid+4,7,-3342.6,1054.95,45.4535,0,0,0,0,0,0,0,0,0,4.92643,0,0),
(@guid+4,8,-3342.39,1043.87,43.4964,0,0,0,0,0,0,0,0,0,3.82295,0,0),
(@guid+4,9,-3357.42,1034.57,41.0994,0,0,0,0,0,0,0,0,0,3.95726,0,0),
(@guid+4,10,-3365.29,1017.92,33.716,0,0,0,0,0,0,0,0,0,4.72693,0,0),
(@guid+4,11,-3358.28,986.865,28.8074,0,0,0,0,0,0,0,0,0,5.71259,0,0),
(@guid+4,12,-3343.54,975.584,30.8439,0,0,0,0,0,0,0,0,0,5.95214,0,0),
(@guid+4,13,-3331.61,970.294,29.6034,0,0,0,0,0,0,0,0,0,6.07387,0,0),
(@guid+4,14,-3315.27,966.89,32.3896,0,0,0,0,0,0,0,0,0,0.120555,0,0),
(@guid+4,15,-3302.97,967.504,34.9652,0,0,0,0,0,0,0,0,0,0.528962,0,0),
(@guid+4,16,-3291.19,975.843,38.2663,0,0,0,0,0,0,0,0,0,0.854902,0,0),
(@guid+4,17,-3278.5,991.971,42.9526,0,0,0,0,0,0,0,0,0,1.45966,0,0),
(@guid+4,18,-3276.74,1007.7,47.4324,0,0,0,0,0,0,0,0,0,1.3497,0,0),
(@guid+4,19,-3273.8,1018.81,48.3504,0,0,0,0,0,0,0,0,0,0.752801,0,0),
(@guid+4,20,-3247.58,1044.13,54.8317,0,0,0,0,0,0,0,0,0,2.00158,0,0),
(@guid+4,21,-3282,1113.23,55.3277,0,0,0,0,0,0,0,0,0,1.46359,0,0),
(@guid+4,22,-3281.22,1143.76,54.9456,0,0,0,0,0,0,0,0,0,2.24113,0,0),
(@guid+4,23,-3304.47,1170.87,57.3955,0,0,0,0,0,0,0,0,0,3.63914,0,0),
(@guid+4,24,-3329.39,1161.3,57.2152,0,0,0,0,0,0,0,0,0,2.74379,0,0),
(@guid+4,25,-3343.26,1173.6,59.9309,0,0,0,0,0,0,0,0,0,2.40214,0,0),
(@guid+4,26,-3345.25,1178.61,60.6426,0,0,0,0,0,0,0,0,0,2.4092,0,0),
(@guid+5,1,-3028.02,1581.67,64.2494,0,0,0,0,0,0,0,0,0,2.03534,0,0),
(@guid+5,2,-3028.36,1586.81,64.194,0,0,0,0,0,0,0,0,0,1.63637,0,0),
(@guid+5,3,-3028.46,1596.54,59.418,0,0,0,0,0,0,0,0,0,2.26468,0,0),
(@guid+5,4,-3064.63,1628.56,60.3787,0,0,0,0,0,0,0,0,0,1.01197,0,0),
(@guid+5,5,-3054.28,1645.89,64.0629,0,0,0,0,0,0,0,0,0,1.79736,0,0),
(@guid+5,6,-3059.14,1668.62,67.1315,0,0,0,0,0,0,0,0,0,2.44532,0,0),
(@guid+5,7,-3097.5,1706.17,68.492,0,0,0,0,0,0,0,0,0,1.279,0,0),
(@guid+5,8,-3082.57,1740.85,72.1624,0,0,0,0,0,0,0,0,0,0.073414,0,0),
(@guid+5,9,-3059.49,1742.78,75.1391,0,0,0,0,0,0,0,0,0,0.399355,0,0),
(@guid+5,10,-3046.86,1752.01,75.399,0,0,0,0,0,0,0,0,0,5.50445,0,0),
(@guid+5,11,-3023.05,1733.12,75.1709,0,0,0,0,0,0,0,0,0,0.238352,0,0),
(@guid+5,12,-3001.55,1739.61,75.5879,0,0,0,0,0,0,0,0,0,5.33166,0,0),
(@guid+5,13,-2997.25,1722.5,74.1977,0,0,0,0,0,0,0,0,0,4.83686,0,0),
(@guid+5,14,-2994.86,1702.15,71.6494,0,0,0,0,0,0,0,0,0,5.50052,0,0),
(@guid+5,15,-2967.53,1666.31,66.9312,0,0,0,0,0,0,0,0,0,5.30418,0,0),
(@guid+5,16,-2950.68,1643.32,57.4303,0,0,0,0,0,0,0,0,0,4.03969,0,0),
(@guid+5,17,-2975.16,1615.84,54.3787,0,0,0,0,0,0,0,0,0,4.1143,0,0),
(@guid+5,18,-2979.98,1606.67,55.4944,0,0,0,0,0,0,0,0,0,3.08936,0,0),
(@guid+5,19,-3003.71,1605.77,58.9754,0,0,0,0,0,0,0,0,0,3.42708,0,0),
(@guid+5,20,-3028.1,1596.8,59.3902,0,0,0,0,0,0,0,0,0,4.64052,0,0),
(@guid+5,21,-3027.81,1585.9,64.2028,0,0,0,0,0,0,0,0,0,4.75832,0,0),
(86744,1,-294.88,6951.41,19.3571,0,0,0,0,0,0,0,0,0,0.190924,0,0),
(86744,2,-264.713,6967.21,18.5643,0,0,0,0,0,0,0,0,0,6.13246,0,0),
(86744,3,-238.936,6962.83,18.4649,0,0,0,0,0,0,0,0,0,5.29602,0,0),
(86744,4,-223.667,6933.64,18.847,0,0,0,0,0,0,0,0,0,6.01465,0,0),
(86744,5,-206.707,6923.1,19.2127,0,0,0,0,0,0,0,0,0,5.8026,0,0),
(86744,6,-174.357,6912.01,23.7861,0,0,0,0,0,0,0,0,0,6.01858,0,0),
(86744,7,-133.379,6904.8,19.1708,0,0,0,0,0,0,0,0,0,5.99895,0,0),
(86744,8,-89.2117,6888.52,18.7763,0,0,0,0,0,0,0,0,0,6.12461,0,0),
(86744,9,-10.2975,6909.53,18.2978,0,0,0,0,0,0,0,0,0,1.88346,0,0),
(86744,10,-18.0022,6939.27,21.741,0,0,0,0,0,0,0,0,0,1.54574,0,0),
(86744,11,-25.1892,6997.55,20.889,0,0,0,0,0,0,0,0,0,1.39258,0,0),
(86744,12,-24.8436,7035.61,17.8247,0,0,0,0,0,0,0,0,0,1.14518,0,0),
(86744,13,6.85314,7099.44,17.3786,0,0,0,0,0,0,0,0,0,1.44756,0,0),
(86744,14,25.5966,7264.21,17.4588,0,0,0,0,0,0,0,0,0,1.962,0,0),
(86744,15,12.2616,7293.45,17.3838,0,0,0,0,0,0,0,0,0,3.42677,0,0),
(86744,16,-41.0481,7273.87,17.9097,0,0,0,0,0,0,0,0,0,2.51963,0,0),
(86744,17,-85.6322,7318.57,17.6278,0,0,0,0,0,0,0,0,0,2.6398,0,0),
(86744,18,-89.8231,7394.33,17.6309,0,0,0,0,0,0,0,0,0,3.17387,0,0),
(86744,19,-163.533,7388.21,17.2929,0,0,0,0,0,0,0,0,0,3.51552,0,0),
(86744,20,-188.143,7374.22,17.5246,0,0,0,0,0,0,0,0,0,2.56126,0,0),
(86744,21,-209.081,7387.84,19.2417,0,0,0,0,0,0,0,0,0,2.2039,0,0),
(86744,22,-223.03,7406.85,17.6799,0,0,0,0,0,0,0,0,0,3.05998,0,0),
(86744,23,-316.638,7413.45,17.396,0,0,0,0,0,0,0,0,0,0.150871,0,0),
(86745,1,-1023.69,5095.25,17.3839,0,0,0,0,0,0,0,0,0,6.00237,0,0),
(86745,2,-931.962,5086.47,17.7585,0,0,0,0,0,0,0,0,0,6.18772,0,0),
(86745,3,-814.518,5125.51,17.8079,0,0,0,0,0,0,0,0,0,0.481806,0,0),
(86745,4,-777.376,5149.43,17.8128,0,0,0,0,0,0,0,0,0,0.858797,0,0),
(86745,5,-680.908,5288.44,17.7527,0,0,0,0,0,0,0,0,0,0.968753,0,0),
(86745,6,-689.065,5349.76,17.9837,0,0,0,0,0,0,0,0,0,2.14292,0,0),
(86746,1,1172.09,8023.15,17.7483,0,0,0,0,0,0,0,0,0,0.670779,0,0),
(86746,2,1205.67,8081.13,18.0472,0,0,0,0,0,0,0,0,0,0.886782,0,0),
(86746,3,1246.97,8119.73,18.0185,0,0,0,0,0,0,0,0,0,1.69967,0,0),
(86746,4,1244.49,8164.48,19.4185,0,0,0,0,0,0,0,0,0,1.64076,0,0),
(86746,5,1223.65,8202.27,17.7094,0,0,0,0,0,0,0,0,0,1.75465,0,0),
(86746,6,1221.96,8226.97,17.6808,0,0,0,0,0,0,0,0,0,2.04917,0,0),
(86746,7,1197.53,8287.43,18.2173,0,0,0,0,0,0,0,0,0,0.91427,0,0),
(86746,8,1216.92,8311.79,18.6032,0,0,0,0,0,0,0,0,0,2.1552,0,0),
(86746,9,1196.57,8343.54,17.3991,0,0,0,0,0,0,0,0,0,3.05055,0,0),
(86746,10,1088.8,8342.08,17.3746,0,0,0,0,0,0,0,0,0,3.07019,0,0),
(86746,11,1045.06,8342.71,21.9398,0,0,0,0,0,0,0,0,0,2.97201,0,0),
(86746,12,1011.94,8349.03,19.6497,0,0,0,0,0,0,0,0,0,3.29403,0,0),
(86746,13,930.204,8321.25,17.427,0,0,0,0,0,0,0,0,0,4.26399,0,0),
(86746,14,906.417,8281.23,18.9275,0,0,0,0,0,0,0,0,0,4.65276,0,0),
(86746,15,908.587,8226.88,18.308,0,0,0,0,0,0,0,0,0,5.06667,0,0),
(86746,16,942.57,8148.69,17.3847,0,0,0,0,0,0,0,0,0,0.012623,0,0),
(86746,17,1006.13,8155.76,17.3811,0,0,0,0,0,0,0,0,0,5.54183,0,0),
(86746,18,1059.14,8110.92,17.4296,0,0,0,0,0,0,0,0,0,0.040111,0,0),
(86746,19,1108.14,8112.69,17.3877,0,0,0,0,0,0,0,0,0,5.53398,0,0),
(86746,20,1140.55,8059.55,17.6974,0,0,0,0,0,0,0,0,0,5.00776,0,0),
(86746,21,1151.68,8029.68,17.6969,0,0,0,0,0,0,0,0,0,5.90311,0,0);


DELETE FROM `pool_template` WHERE `entry` = 1187;
INSERT INTO `pool_template` VALUES
(1187,1,'Ambassador Jerrikar (18695)'),
(@pool_entry+1,1,'Bog Lurker (18682)');

 
DELETE FROM `pool_creature_template` WHERE `id` = 18695;
INSERT INTO `pool_creature_template` VALUES
(18695,1187,0,'Ambassador Jerrikar (18695)'),
(18682,@pool_entry+1,0,'Bog Lurker (18682)');





        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
        -- -- PLACE UPDATE SQL ABOVE -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
        -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -

        -- If we get here ok, commit the changes
        IF bRollback = TRUE THEN
            ROLLBACK;
            SHOW ERRORS;
            SELECT '* UPDATE FAILED *' AS `===== Status =====`,@cCurResult AS `===== DB is on Version: =====`;
        ELSE
            COMMIT;
            -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
            -- UPDATE THE DB VERSION
            -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- -
            INSERT INTO `db_version` VALUES (@cNewVersion, @cNewStructure, @cNewContent, @cNewDescription, @cNewComment);
            SET @cNewResult := (SELECT description FROM db_version WHERE `version`=@cNewVersion AND `structure`=@cNewStructure AND `content`=@cNewContent);

            SELECT '* UPDATE COMPLETE *' AS `===== Status =====`,@cNewResult AS `===== DB is now on Version =====`;
        END IF;
    ELSE    -- Current version is not the expected version
        IF (@cCurResult = @cNewResult) THEN    -- Does the current version match the new version
            SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cCurResult AS `===== DB is already on Version =====`;
        ELSE    -- Current version is not one related to this update
            IF(@cCurResult IS NULL) THEN    -- Something has gone wrong
                SELECT '* UPDATE FAILED *' AS `===== Status =====`,'Unable to locate DB Version Information' AS `============= Error Message =============`;
            ELSE
                IF(@cOldResult IS NULL) THEN    -- Something has gone wrong
                    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurStructure := (SELECT `STRUCTURE` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurContent := (SELECT `Content` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurOutput = CONCAT(@cCurVersion, '_', @cCurStructure, '_', @cCurContent, ' - ',@cCurResult);
                    SET @cOldResult = CONCAT('Rel',@cOldVersion, '_', @cOldStructure, '_', @cOldContent, ' - ','IS NOT APPLIED');
                    SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cOldResult AS `=== Expected ===`,@cCurOutput AS `===== Found Version =====`;
                ELSE
                    SET @cCurVersion := (SELECT `version` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurStructure := (SELECT `STRUCTURE` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurContent := (SELECT `Content` FROM db_version ORDER BY `version` DESC, STRUCTURE DESC, CONTENT DESC LIMIT 0,1);
                    SET @cCurOutput = CONCAT(@cCurVersion, '_', @cCurStructure, '_', @cCurContent, ' - ',@cCurResult);
                    SELECT '* UPDATE SKIPPED *' AS `===== Status =====`,@cOldResult AS `=== Expected ===`,@cCurOutput AS `===== Found Version =====`;
                END IF;
            END IF;
        END IF;
    END IF;
END $$

DELIMITER ;

-- Execute the procedure
CALL update_mangos();

-- Drop the procedure
DROP PROCEDURE IF EXISTS `update_mangos`;


